/*! jedios 2013-09-29 */
(function(){angular.module("common",[]),angular.module("core",["common"]),angular.module("core").run(["apps","$rootScope","common.message",function(a,b,c){return b.$$page_title="jOS",a.load(),c.subscribe("app")}]),$(function(){return angular.bootstrap(document,["core"])}),angular.module("core").directive("coreNavbar",["$templateCache",function(a){return{template:a.get("navbar.html"),replace:!0,link:function(){}}}]),angular.module("core").service("apps",["$http","$rootScope",function($http,$rootScope){var loadCss,loadJs;return loadJs=function(js){return eval(js)},loadCss=function(){},$(document).on("app_reg",function(a,b){return $rootScope.$$apps=$rootScope.$$apps||[],$rootScope.$$apps.push(b)}),{load:function(){return $http.get("settings.json").success(function(a){return $rootScope.$$settings=a,async.eachSeries(a.apps,function(a,b){return async.waterfall([function(b){return $http.get(""+a+"/js/main.js").success(function(a){return loadJs(a),b(null)})},function(b){return $http.get(""+a+"/js/templates.js").success(function(a){return loadJs(a),b(null)})},function(b){return $http.get(""+a+"/css/main.css").success(function(a){return loadCss(a),b(null)})},function(b){return $rootScope.$broadcast("app_loaded",a),b(null)}],function(){return b()})},function(){return $rootScope.$broadcast("app_loaded_all")})})},active:function(a){var b,c,d,e,f,g;if(b=$("#"+a.name),0===b.length)return $http.get(""+a.name+"/index.html").success(function(c){var d,e,f,g,h;for($("#apps > .app").hide(),b=$("<div/>"),b.attr({id:a.name}).addClass("app").append(c).appendTo($("#apps")),angular.bootstrap(b,[a.name]),a.loaded=!0,g=$rootScope.$$apps,h=[],e=0,f=g.length;f>e;e++)d=g[e],h.push(d.actived=d===a);return h}).error(function(){});if(1===b.length){for($("#apps > .app").hide(),b.show(),f=$rootScope.$$apps,g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(c.actived=c===a);return g}}}}]),angular.module("common").service("common.message",["$rootScope","$rootElement",function(a,b){return b[0]===document&&($(document).data("channels",{}),$(document).on("msg",function(a,b){var c,d,e,f,g,h;if(c=$(document).data("channels"),c[b.channel]){for(g=c[b.channel],h=[],e=0,f=g.length;f>e;e++)d=g[e],h.push(d.$broadcast("msg",{from:a.target.id,channel:b.channel,message:b.message}));return h}})),{publish:function(a,c){return b.trigger("msg",{channel:a,message:c})},subscribe:function(b){var c;return c=$(document).data("channels"),c[b]=c[b]||[],c[b].push(a)}}}]),angular.module("core").controller("CoreController",["$scope","$rootElement","apps","common.message",function(a,b,c){return b.attr("id","core"),a.$on("app_loaded_all",function(){return a.show=!0,a.$digest()}),a.activeApp=function(a){return c.active(a)},a.$on("msg",function(a,b){return console.log(a,b)})}])}).call(this);